box: wercker/ubuntu12.04-nodejs0.10
build:
  # The steps that will be executed on build
  steps:
    # Install packages
    #- install-packages:
    #    packages: lua5.2

    #- script:
    #    name: echo lua information
    #    code: |
    #      luac -v

    # Install packages
    - install-packages:
        packages: zsh

    # A custom script step, name value is used in the UI
    # and the code value contains the command that get executed
    - script:
        name: update npm version
        code: |
            sudo npm update -g npm

    - script:
        name: echo nodejs information
        code: |
          echo "node version $(node -v) running"
          echo "npm version $(npm -v) running"

    - script:
        name: add coveralls environment variables
        code : |
          export COVERALLS_SERVICE_NAME="wercker.com"
          export COVERALLS_GIT_COMMIT=$WERCKER_GIT_COMMIT
          export COVERALLS_GIT_BRANCH=$WERCKER_GIT_BRANCH
          export COVERALLS_SERVICE_JOB_ID=$WERCKER_BUILD_ID

    - script:
        name: cache npm directory
        code: |
          mkdir -p $WERCKER_CACHE_DIR/node_modules
          ln -sf $WERCKER_CACHE_DIR/node_modules ./node_modules

    # A step that executes `npm install` command
    - npm-install

    # A step that executes `npm test` command
    - npm-test

    - script:
        name: test install.bash script
        code: |
          bash ./bin/install.bash

    - script:
        name: test install.bash script with deps
        code: |
          bash ./bin/install.bash --deps

  after-steps:
    - wantedly/pretty-slack-notify:
        webhook_url: $SLACK_WEBHOOK_URL

